{% extends 'layout/layout.html' %}
{% load static %}
{% load ui_extras %}

{% block content %}
<div class="row g-3 mb-3">
  <div class="col-md-6">
    <form method="get" class="d-flex gap-2">
      <input type="text" class="form-control" name="search" value="{{ search }}" placeholder="Buscar por código, nombre o cliente">
      <select class="form-select" name="estado" title="Estado">
        <option value="">Completados/Cancelados</option>
        <option value="completado" {% if estado == 'completado' %}selected{% endif %}>Completado</option>
        <option value="cancelado" {% if estado == 'cancelado' %}selected{% endif %}>Cancelado</option>
        <option value="produccion" {% if estado == 'produccion' %}selected{% endif %}>En Producción</option>
        <option value="aprobado" {% if estado == 'aprobado' %}selected{% endif %}>Aprobado</option>
        <option value="optimizado" {% if estado == 'optimizado' %}selected{% endif %}>Optimizado</option>
        <option value="en_proceso" {% if estado == 'en_proceso' %}selected{% endif %}>En Proceso</option>
        <option value="borrador" {% if estado == 'borrador' %}selected{% endif %}>Borrador</option>
      </select>
      <button class="btn btn-primary" type="submit">Filtrar</button>
    </form>
  </div>
  <div class="col-md-6 text-end">
    <a class="btn btn-outline-secondary" href="{% url 'operador_home' %}">← Volver a asignados</a>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>ID del proyecto</th>
            <th>Nombre</th>
            <th>Cliente</th>
            <th>Estado</th>
            <th>Actualizado</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for p in proyectos %}
          <tr>
            <td>{{ p.public_id|default:p.id }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.cliente.nombre }}</td>
            <td><span class="badge {{ p.estado|estado_badge }}">{{ p.get_estado_display }}</span></td>
            <td>{{ p.fecha_modificacion|date:'Y-m-d H:i' }}</td>
            <td class="text-end"><a class="btn btn-sm btn-primary" href="{% url 'operador_proyecto' p.id %}">Abrir</a></td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">No hay proyectos en historial con los filtros actuales.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
